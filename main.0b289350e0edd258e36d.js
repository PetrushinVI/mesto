(()=>{"use strict";class e{constructor(e,t,s,{cardClick:r,deleteClick:i,likeClick:n}){this._data=e,this._name=e.name,this._link=e.link,this._likes=e.likes,this._cardId=e._id,this._userId=t,this._templateSelector=s,this._cardClick=r,this._likeClick=n,this._deleteClick=i,this._element=this._getTemplate(),this._elementImg=this._cardElement.querySelector(".element__picture"),this._elementTitle=this._cardElement.querySelector(".element__text"),this._elementDelete=this._cardElement.querySelector(".element__delete"),this._elementLike=this._cardElement.querySelector(".element__btn"),this._counterLikes=this._cardElement.querySelector(".element__like-counter"),this._isUserCard=t===e.owner._id}checkLike(){return this._likes.some((e=>e._id===this._userId))}_addLike(){this._elementLike.classList.add("element__btn_active")}_deleteLike(){this._elementLike.classList.remove("element__btn_active")}_setListenersItems(){this._elementDelete.addEventListener("click",this._deleteClick),this._elementLike.addEventListener("click",(()=>{this._likeClick(this._cardId),this.toggleLikes()})),this._elementImg.addEventListener("click",(()=>{this._cardClick(this._name,this._link)})),this._isUserCard?this._elementDelete.addEventListener("click",(()=>{this._deleteClick(this._cardId,this._element)})):(this._elementDelete.remove(),this._elementDelete=null)}_getTemplate(){return this._cardElement=document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0),this._cardElement}createElement(){return this._elementTitle.textContent=this._name,this._elementImg.alt=this._name,this._elementImg.src=this._link,this.setLike(this._likes),this._setListenersItems(),this._element}toggleLikes(){this.checkLike()?this._addLike():this._deleteLike()}setLike(e){this._likes=e,this._counterLikes.textContent=this._likes.length,this.toggleLikes()}}class t{constructor(e,t){this._config=e,this._form=t,this._inputList=Array.from(this._form.querySelectorAll(this._config.inputSelector)),this._buttonElement=this._form.querySelector(this._config.submitButtonSelector)}_getErrorElement(e){return this._form.querySelector(`#${e.id}-error`)}_showError(e,t){const s=this._getErrorElement(e),{errorClass:r,inputErrorClass:i}=this._config;s.classList.add(r),s.textContent=t,e.classList.add(i)}_hideError(e){const t=this._getErrorElement(e),{errorClass:s,inputErrorClass:r}=this._config;t.classList.remove(s),t.textContent="",e.classList.remove(r)}resetValidation=()=>{this.toggleButtonState(),this._inputList.forEach((e=>{this._hideError(e)}))};_checkValidateInput(e){e.validity.valid?this._hideError(e):this._showError(e,e.validationMessage)}toggleButtonState(){this._inputList.some((e=>!e.validity.valid))?(this._buttonElement.classList.add(this._config.inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._config.inactiveButtonClass),this._buttonElement.disabled=!1)}_setEventListeners=()=>{this.toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkValidateInput(e),this.toggleButtonState()})),this._form.addEventListener("reset",(()=>{setTimeout((()=>{this.toggleButtonState()}),0)}))}))};enableValidation=()=>{this._setEventListeners()}}class s{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup")||e.target.classList.contains("popup__close"))&&this.close()}))}}class r extends s{constructor(e,t){super(e),this._handleFormSubmit=t,this._popupForm=this._popup.querySelector(".form"),this._inputs=this._popup.querySelectorAll(".form__input"),this._submitButtonElement=this._popup.querySelector(".form__btn")}_getInputValues(){return this._formValues={},this._inputs.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}close(){this._popupForm.reset(),super.close()}renderLoading(e){this._submitButtonElement.textContent=!0===e?"Сохранение...":"Сохранить"}}const i=document.querySelector(".profile__btn"),n=(document.querySelector(".edit-profile"),document.querySelector(".profile__add-btn")),o=(document.querySelector(".profile__name"),document.querySelector(".profile__description"),document.querySelector(".elements")),a=(document.querySelector(".popup-image"),document.querySelector(".profile__avatar"),document.querySelector(".profile__avatar_edit"),document.querySelector(".popup__button_type_delete"),document.forms.profileForm),l=document.forms.popupFormAdd,c=document.querySelector(".form_type_avatar"),_=(document.querySelector(".form__input_type_name-card"),document.querySelector(".form__input_type_url-card"),document.querySelector(".form__input_type_name")),h=document.querySelector(".form__input_type_about"),d=document.querySelector(".form__input_type_avatar"),u=document.querySelector(".profile__avatar-button"),p={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__btn",inactiveButtonClass:"form__btn_disabled",inputErrorClass:"form__input_type_error",errorClass:"popup__error_visible"},m=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then(this._checkResponse)}_checkResponse(e){return e.ok?e.json():Promise.reject(`${e.status} ${e.statusText}`)}getInitialCard(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}editUserInfo(e,t){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}addCard(e,t){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}editUserAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}addLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}deleteLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-60",headers:{authorization:"4515d0f2-bb83-494a-804c-6a6db4ace47a","Content-Type":"application/json"}}),f=new t(p,c),k=new t(p,a),L=new t(p,l),g=new class{constructor({userName:e,userInfo:t,userAvatar:s}){this._userName=document.querySelector(e),this._userInfo=document.querySelector(t),this._userAvatar=document.querySelector(s)}getUserInfo(){return{name:this._userName.textContent,about:this._userInfo.textContent}}setUserInfo(e){this._userName.textContent=e.name,this._userInfo.textContent=e.about,this._userAvatar.src=e.avatar,this._userId=e.userId}}({userName:".profile__name",userInfo:".profile__description",userAvatar:".profile__avatar"}),E=new class extends s{constructor(e){super(e),this._popupImage=this._popup.querySelector(".popup__image-item"),this._popupImageTitle=this._popup.querySelector(".popup__image-title")}open(e,t){super.open(),this._popupImageTitle.textContent=e,this._popupImage.src=t,this._popupImage.alt=e}}(".popup_type_big-img"),v=new class extends s{constructor(e,t){super(e),this._submitButton=this._popup.querySelector(".form__btn"),this._popupForm=this._popup.querySelector(".form"),this._deleteClick=t}renderLoading(e){this._submitButton.textContent=e?"Удаление...":"Да"}open(e,t){super.open(),this._id=e,this._card=t}deleteCard(){this._card.remove()}setEventListeners(){this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._deleteClick(this._id,this._card)})),super.setEventListeners()}}(".popup_card-delete",((e,t)=>q(e,t))),y=new class{constructor({renderer:e},t){this._renderer=e,this._container=t}renderItems(e){e.forEach(this._renderer)}addItem(e){this._container.prepend(e)}addItemAppend(e){this._container.append(e)}}({renderer:e=>{y.addItemAppend(I(e))}},o),b=new r(".popup_avatar",(()=>{b.renderLoading(!0),m.editUserAvatar(d.value).then((e=>{g.setUserInfo(e),b.close()})).catch((e=>{console.error(e)})).finally((()=>{b.renderLoading(!1)}))})),S=new r(".popup_profile",(e=>{S.renderLoading(!0),m.editUserInfo(e.inputName,e.inputAbout).then((e=>{g.setUserInfo(e),S.close()})).catch((e=>{console.error(e)})).finally((()=>{S.renderLoading(!1)}))})),C=new r(".popup_cards",(e=>{C.renderLoading(!0),m.addCard(e.inputNameCard,e.inputUrlCard).then((e=>{y.addItem(I(e)),C.close()})).catch((e=>{console.error(e)})).finally((()=>C.renderLoading(!1)))})),I=t=>{const s=new e(t,U,"#card-template",{cardClick:(e,t)=>{E.open(e,t)},likeClick:e=>{s.checkLike()?m.deleteLike(e).then((e=>{s.setLike(e.likes)})).catch((e=>console.log(e))):m.addLike(e).then((e=>{s.setLike(e.likes)})).catch((e=>{console.log(e)}))},deleteClick:(e,t)=>{v.open(e,t)}});return s.createElement()},q=(e,t)=>{v.renderLoading(!0),m.deleteCard(e).then((()=>{v.deleteCard(),v.close()})).catch((e=>{console.log(e)})).finally((()=>v.renderLoading(!1)))};let U=null;Promise.all([m.getUserInfo(),m.getInitialCard()]).then((([e,t])=>{g.setUserInfo(e),U=e._id,(e=>{y.renderItems(e)})(t)})).catch((e=>{console.log(e)})),u.addEventListener("click",(()=>{f.resetValidation(),b.open()})),i.addEventListener("click",(()=>{k.resetValidation(),k.toggleButtonState();const{name:e,about:t}=g.getUserInfo();_.value=e,h.value=t,S.open()})),n.addEventListener("click",(function(){L.resetValidation(),L.toggleButtonState(),C.open()})),b.setEventListeners(),S.setEventListeners(),C.setEventListeners(),E.setEventListeners(),v.setEventListeners(),f.enableValidation(),k.enableValidation(),L.enableValidation()})();